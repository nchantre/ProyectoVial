# ADR-003: Entity Framework Core con Database First (sin migraciones)

## Estado
Aceptado

## Contexto
Se requiere implementar acceso a datos para la API de siniestros viales. Las opciones principales son:
- Entity Framework Core (ORM)
- ADO.NET (acceso directo a BD)
- Dapper (micro-ORM)

Además, se debe decidir entre:
- Code First (EF Core crea la BD)
- Database First (BD existe, EF Core se conecta)

## Decisión
Usar **Entity Framework Core 8.0** con enfoque **Database First** (sin migraciones):

1. La base de datos se crea **manualmente** ejecutando scripts SQL
2. EF Core se configura para **conectarse a la BD existente**
3. **NO se usan migraciones** de EF Core
4. Las configuraciones de entidades se hacen mediante **Fluent API**

## Razones

### Por qué EF Core (vs ADO.NET/Dapper)
- ✅ Mejor integración con Clean Architecture y DDD
- ✅ Soporte nativo para relaciones y navegación
- ✅ Type-safe queries con LINQ
- ✅ Cambio de tracking (AsNoTracking) para mejor rendimiento
- ✅ Facilita el uso de Value Objects y entidades ricas
- ✅ Soporte para Include() para cargar relaciones

### Por qué Database First (vs Code First)
- ✅ Control total sobre el esquema de la base de datos
- ✅ Permite optimizaciones específicas de SQL Server (índices, constraints)
- ✅ Scripts SQL son versionables y auditable
- ✅ Facilita la creación de índices compuestos y optimizaciones avanzadas
- ✅ No requiere conocimiento de migraciones de EF Core

### Por qué sin migraciones
- ✅ La BD se crea una vez con scripts SQL
- ✅ Evita complejidad de migraciones en desarrollo
- ✅ Scripts SQL son más explícitos y controlables
- ✅ Facilita el despliegue en diferentes entornos

## Implementación

### 1. Scripts SQL
```
Scripts/
├── 01_CreateDatabase.sql    # Crear BD
├── 02_CreateTables.sql       # Crear tablas
├── 03_CreateIndexes.sql      # Crear índices
└── 04_InsertSampleData.sql   # Datos de ejemplo (opcional)
```

### 2. Configuración EF Core

```csharp
// Program.cs
builder.Services.AddDbContext<SiniestrosVialesDbContext>(options =>
    options.UseSqlServer(connectionString));
```



